<html dir="ltr"><head><title>Exercise - Create an Azure virtual network - Learn :: Reader View</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <style>
html {
  overflow: overlay;
}
body {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  margin: 30px auto 0 auto;
  padding: 10px;
}
body[data-mode="light"] {
  color:  #222;
  background-color:  whitesmoke;
}
body[data-mode="dark"] {
  color:  #eee;
  background-color:  #333;
}
body[data-mode="sepia"] {
  color:  #5b4636;
  background-color:  #f4ecd8;
}
body[data-mode="solarized-light"] {
  color:  #586e75;
  background-color:  #fdf6e3;
}
body[data-mode="nord-light"] {
  color:  #2e3440;
  background-color:  #e5e9f0;
}
body[data-mode="groove-dark"] {
  color:  #cec4ac;
  background-color:  #282828;
}
body[data-mode="solarized-dark"] {
  color:  #93a1a1;
  background-color:  #002b36;
}
body[data-mode="nord-dark"] {
  color:  #e5e9f0;
  background-color:  #2e3440;
}
@media print {
  body[data-mode="light"],
  body[data-mode="dark"],
  body[data-mode="sepia"],
  body[data-mode="solarized-light"],
  body[data-mode="nord-light"],
  body[data-mode="groove-dark"],
  body[data-mode="solarized-dark"],
  body[data-mode="nord-dark"] {
    color: #000;
    background-color: #fff;
  }
}
body[data-loaded=true] {
  
}
img {
  max-width: 100%;
  height: auto;
}
body[data-images=false] canvas,
body[data-images=false] svg,
body[data-images=false] img {
  display: none;
}
a {
  color: #0095dd;
  text-decoration: none;
}
#reader-domain {
  font-family: Helvetica, Arial, sans-serif;
  text-decoration: none;
  border-bottom-color: currentcolor;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 100%;
  display: inline-block;
  direction: ltr;
}
#reader-domain > span:first-child {
  font-size: 1.1em;
}
#reader-domain > span:last-child {
  font-size: 0.8em;
}
#reader-title {
  font-size: 1.6em;
  line-height: 1.25em;
  width: 100%;
  margin: 20px 0;
  padding: 0;
}
#reader-credits {
  font-size: 0.9em;
  line-height: 1.48em;
  margin: 0 0 10px 0;
  padding: 0;
  font-style: italic;
}
#reader-estimated-time {
  font-size: 0.85em;
  line-height: 1.48em;
  margin: 0 0 10px 0;
  padding: 0;
}
#reader-credits:empty {
  display: none;
}
body[data-speech="true"] .tts-box {
  position: absolute;
  left: 0;
  width: 100vw;
  height: 32px;
  z-index: 1;
  pointer-events: none;
  box-shadow: 0 0 0 1000vw rgba(128, 128, 128, 0.2);
}
body[data-speech="true"] .tts-word {
  position: absolute;
  z-index: 1;
  pointer-events: none;
  background-color: red;
  height: 2px;
}
.tts-word.hidden,
.tts-box.hidden {
  display: none;
}
body[data-speech="false"] .tts-speaking::after {
  display: none;
}
mark.hghlght {
  background-color: #ffff81;
}
</style>
  <style id="user-css">body {
  padding-bottom: 64px;
}
a:visited {
  color: #d33bf0;
}
a:link, a:link:hover, a:link:active {
  color: #0095dd;
}
a:link {
  text-decoration: none;
  font-weight: normal;
}
pre {
  white-space: pre-wrap;
}
pre code {
  background-color: #eff0f1;
  color: #393318;
  font-family: monospace;
  display: block;
  padding: 5px 10px;
}
body[data-mode="dark"] pre code {
  background-color: #585858;
  color: #e8e8e8;
}

/* CSS for sans-serif fonts */
body[data-font=sans-serif] {}
/* CSS for serif fonts */
body[data-font=serif] {}

/* CSS for "sepia" theme */
body[data-mode=sepia] {
}
/* CSS for "light" theme */
body[data-mode=light] {}
/* CSS for "dark" theme */
body[data-mode=dark] {}</style>
</head>
<body data-images="true" data-mode="sepia" data-font="sans-serif" data-loaded="true">
  <span></span> <!-- for IntersectionObserver -->
  <a id="reader-domain" href="https://docs.microsoft.com/en-gb/learn/modules/configure-network-for-azure-virtual-machines/3-exercise-create-azure-virtual-network">
    <span>docs.microsoft.com</span>
    <span>/en-gb/learn/modules/configure-network-for-azure-virtual-machines/3-exercise-create-azure-virtual-network</span>
  </a>
  <h1 dir="auto" id="reader-title">Exercise - Create an Azure virtual network - Learn</h1>
  <div dir="auto" id="reader-credits">cwatson-cat</div>
  <div dir="auto" id="reader-estimated-time">6-7 minutes</div>
  <hr>
  <div id="readability-page-1" class="page"><div id="unit-inner-section">
		
		
		<ul>
			<li>20 minutes</li>
		</ul>
			<p>In this exercise, you will create a virtual network in Microsoft Azure. You will then create two virtual machines, and use the virtual network to connect the virtual machines and to the internet.</p>
<div>
<p> Important</p>
<p>The exercises in this module require a full Azure subscription. The exercises are optional, and are not required to complete this module. Participating in the interactive exercises in this module will result in charges billed to the Azure subscription you use to complete them. Incurred charges can be minimized by cleaning up the resources you create as soon as possible. Cleanup directions are in the final unit.</p>
</div>
<h2 id="sign-in-to-your-subscription">Sign in to your subscription</h2>
<p>Sign in to Azure either by using the PowerShell cmdlet <code>Connect-AzAccount</code> on your local machine or by using <a href="https://shell.azure.com/powershell" data-linktype="external">shell.azure.com/powershell</a>.</p>
<h2 id="create-a-resource-group">Create a resource group</h2>
<p>First, create a resource group to contain all of the resources you'll create in this module. Name it <code>vm-networks</code> and replace <code>EastUS</code> in the following command with the name of the region in which you'd like the group to be created.</p>
<pre tabindex="0"><code data-author-content="$Location=&quot;WestUS&quot; 
New-AzResourceGroup -Name vm-networks -Location $Location
"><span><span>$Location</span>=<span>"WestUS"</span> 
<span>New-AzResourceGroup</span><span> -Name</span> <span>vm-networks</span><span> -Location</span> <span>$Location</span>
</span></code></pre>
<h2 id="create-a-subnet-and-virtual-network">Create a subnet and virtual network</h2>
<p>To create a subnet and virtual network, run the following command.</p>
<pre tabindex="0"><code data-author-content=" $Subnet=New-AzVirtualNetworkSubnetConfig -Name default -AddressPrefix 10.0.0.0/24
 New-AzVirtualNetwork -Name myVnet -ResourceGroupName vm-networks -Location $Location -AddressPrefix 10.0.0.0/16 -Subnet $Subnet
"><span> <span>$Subnet</span>=<span>New-AzVirtualNetworkSubnetConfig</span><span> -Name</span> default<span> -AddressPrefix</span> <span>10.0</span>.<span>0.0</span>/<span>24</span>
 <span>New-AzVirtualNetwork</span><span> -Name</span> myVnet<span> -ResourceGroupName</span> <span>vm-networks</span><span> -Location</span> <span>$Location</span><span> -AddressPrefix</span> <span>10.0</span>.<span>0.0</span>/<span>16</span><span> -Subnet</span> <span>$Subnet</span>
</span></code></pre>
<h2 id="create-two-virtual-machines">Create two virtual machines</h2>
<p>All Azure virtual machines are connected to a virtual network. If you create a virtual machine using Azure PowerShell, and don't specify the name of an existing virtual network, Azure PowerShell creates a new virtual network automatically.</p>
<p>Here, we create two virtual machines and specify the virtual network.</p>
<ol>
<li><p>To create the first virtual machine, run the following command to create a Windows VM with a public IP address that is accessible over port 3389 (Remote Desktop). This creates a Windows 2016 Datacenter VM named <code>dataProcStage1</code> that uses the myVnet virtual network.</p>
<pre tabindex="0"><code data-author-content="New-AzVm `
 -ResourceGroupName &quot;vm-networks&quot; `
 -Name &quot;dataProcStage1&quot; `
 -VirtualNetworkName &quot;myVnet&quot; `
 -SubnetName &quot;default&quot; `
 -image &quot;Win2016Datacenter&quot; `
 -Size &quot;Standard_DS2_v2&quot;
"><span><span>New-AzVm</span> `
<span> -ResourceGroupName</span> <span>"vm-networks"</span> `
<span> -Name</span> <span>"dataProcStage1"</span> `
<span> -VirtualNetworkName</span> <span>"myVnet"</span> `
<span> -SubnetName</span> <span>"default"</span> `
<span> -image</span> <span>"Win2016Datacenter"</span> `
<span> -Size</span> <span>"Standard_DS2_v2"</span>
</span></code></pre>
<p>Port 3389 is opened automatically by default when you create a Windows VM in Azure.</p>
</li>
<li><p>Enter a user name and password for the VM. Write down user name and password. You need it later to sign in to the server.</p>
</li>
<li><p>Run the following command to get the public IP address for your VM so you can use it later. Copy the <strong>IpAddress</strong>.</p>
<pre tabindex="0"><code data-author-content="Get-AzPublicIpAddress -Name dataProcStage1
"><span><span>Get-AzPublicIpAddress</span><span> -Name</span> dataProcStage1
</span></code></pre>
</li>
<li><p>Create the second VM named <code>dataProcStage2</code>.</p>
<pre tabindex="0"><code data-author-content="New-AzVm `
 -ResourceGroupName &quot;vm-networks&quot; `
 -Name &quot;dataProcStage2&quot; `
 -VirtualNetworkName &quot;myVnet&quot; `
 -SubnetName &quot;default&quot; `
 -image &quot;Win2016Datacenter&quot; `
 -Size &quot;Standard_DS2_v2&quot;
"><span><span>New-AzVm</span> `
<span> -ResourceGroupName</span> <span>"vm-networks"</span> `
<span> -Name</span> <span>"dataProcStage2"</span> `
<span> -VirtualNetworkName</span> <span>"myVnet"</span> `
<span> -SubnetName</span> <span>"default"</span> `
<span> -image</span> <span>"Win2016Datacenter"</span> `
<span> -Size</span> <span>"Standard_DS2_v2"</span>
</span></code></pre>
</li>
<li><p>Enter a user name and password for the VM. Copy your user name and password. You need it later to sign in to the server.</p>
</li>
<li><p>Disassociate the public IP address that was created by default for the VM.</p>
<pre tabindex="0"><code data-author-content="$nic = Get-AzNetworkInterface -Name dataProcStage2 -ResourceGroup vm-networks
$nic.IpConfigurations.publicipaddress.id = $null
Set-AzNetworkInterface -NetworkInterface $nic 
"><span><span>$nic</span> = <span>Get-AzNetworkInterface</span><span> -Name</span> dataProcStage2<span> -ResourceGroup</span> <span>vm-networks</span>
<span>$nic</span>.IpConfigurations.publicipaddress.id = <span>$null</span>
<span>Set-AzNetworkInterface</span><span> -NetworkInterface</span> <span>$nic</span> 
</span></code></pre>
</li>
</ol>
<h2 id="connect-to-dataprocstage1-using-remote-desktop">Connect to dataProcStage1 using Remote Desktop</h2>
<ol>
<li><p>Open Remote Desktop, and connect to <code>dataProcStage1</code> with the public IP address you noted from the previous steps. If you're using PowerShell locally, run the following command, and replace <code>publicIpAddress</code> with the VM's public IP address.</p>
<pre tabindex="0"><code data-author-content="mstsc /v:publicIpAddress
"><span>mstsc /v:publicIpAddress
</span></code></pre>
</li>
<li><p>Sign in to the remote machine with the username and the password you created.</p>
</li>
<li><p>In the remote session, open the Windows command prompt, and run the following command.</p>
<pre tabindex="0"><code data-author-content="ping dataProcStage2 -4
"><span><span>ping</span> dataProcStage2 -<span>4</span>
</span></code></pre>
</li>
<li><p>In the results, you'll see that all requests to <code>dataProcStage2</code> time out. This is because the default Windows Firewall configuration on <code>dataProcStage2</code> prevents it from responding to pings.</p>
</li>
</ol>
<h2 id="connect-to-dataprocstage2-using-remote-desktop">Connect to dataProcStage2 using Remote Desktop</h2>
<p>Configure the Windows Firewall on <code>dataProcStage2</code> using a new remote desktop session. You can't access <code>dataProcStage2</code> from your desktop because <code>dataProcStage2</code> doesn't have a public IP address. You'll use remote desktop from <code>dataProcStage1</code> to connect to <code>dataProcStage2</code>.</p>
<ol>
<li><p>In the <code>dataProcStage1</code> remote session, open Remote Desktop.</p>
</li>
<li><p>Connect to <code>dataProcStage2</code> by name. Based on the default network configuration, <code>dataProcStage1</code> can resolve the address for <code>dataProcStage2</code> using the computer name.</p>
</li>
<li><p>Sign in to <code>dataProcStage2</code> with the username and the password you created.</p>
</li>
<li><p>On <code>dataProcStage2</code>, select the Start Menu, enter <strong>Firewall</strong>, and press <kbd>Enter</kbd>. The <strong>Windows Firewall with Advanced Security</strong> console appears.</p>
</li>
<li><p>In the left-hand pane, select <strong>Inbound Rules</strong>.</p>
</li>
<li><p>In the right-hand pane, scroll down, and right-click <strong>File and Printer Sharing (Echo Request - ICMPv4-In)</strong>, and then select <strong>Enable Rule</strong>.</p>
</li>
<li><p>Switch back to the <code>dataProcStage1</code> remote session, and run the following command in the command prompt.</p>
<pre tabindex="0"><code data-author-content="ping dataProcStage2 -4
"><span><span>ping</span> dataProcStage2 -<span>4</span>
</span></code></pre>
</li>
<li><p><code>dataProcStage2</code> responds with four replies, demonstrating connectivity between the two VMs.</p>
</li>
</ol>
<p>You successfully created a virtual network, created two VMs that are attached to that virtual network, connected to one of the VMs and shown network connectivity to the other VM within the same virtual network. You can use Azure Virtual Network to connect resources within the Azure network. However, those resources need to be within the same resource group and subscription. Next, we will look at VPN gateways, which enable you to connect virtual network in different resource groups, subscriptions, and even geographical regions.</p>

		<div id="next-section"><hr><div>
		<h2>Next unit: Explore Azure VPN Gateway</h2>
		<p>
			<a href="https://docs.microsoft.com/en-gb/learn/modules/configure-network-for-azure-virtual-machines/4-explore-azure-vpn-gateway/" data-bi-name="continue">
			<span>Continue</span>
			
			</a>
		</p>
	</div></div>
	</div></div>
  <span></span> <!-- for IntersectionObserver -->
  
  
  
  


</body><style>body {
      font-size:  13px;
      font-family: Helvetica, Arial, sans-serif;
      width: 600px;
    }
    .page {
      line-height: unset;
    }
    h1, h2, h3 {
      line-height: initial;
    }</style></html>